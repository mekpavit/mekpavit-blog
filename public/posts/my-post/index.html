<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>If you use &#39;len(s)&#39; to check a string&#39;s length, YOU&#39;RE DOING IT WRONG!! - Mek&#39;s Software Development Blog</title><link rel="icon" type="image/png" href= /><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="If you use &#39;len(s)&#39; to check a string&#39;s length, YOU&#39;RE DOING IT WRONG!!" />
<meta property="og:description" content="Maybe len(s) doesn&rsquo;t work as you expect. If you use it to determine the length of the string, you must read this post!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mekpavit.netlify.app/posts/my-post/" />
<meta property="article:published_time" content="2021-01-03T00:00:00+07:00" />
<meta property="article:modified_time" content="2021-01-03T00:00:00+07:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="If you use &#39;len(s)&#39; to check a string&#39;s length, YOU&#39;RE DOING IT WRONG!!"/>
<meta name="twitter:description" content="Maybe len(s) doesn&rsquo;t work as you expect. If you use it to determine the length of the string, you must read this post!"/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet">

	<link rel="stylesheet" type="text/css" media="screen" href="https://mekpavit.netlify.appcss/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://mekpavit.netlify.appcss/main.css" />
	<link rel="stylesheet" type="text/css" href="https://mekpavit.netlify.appcss/custom.css" />
	

	
	<script src="https://mekpavit.netlify.appjs/main.js"></script>
	<script src="https://mekpavit.netlify.appjs/abc.js"></script>
	<script src="https://mekpavit.netlify.appjs/xyz.js"></script>
	<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<base href="https://mekpavit.netlify.app">
	<h1 class="site-title"><a href="https://mekpavit.netlify.app">Mek&#39;s Software Development Blog</a></h1>
	<div class="site-description"><h2>My personal blog about software development</h2><nav class="nav social">
			<ul class="flat"></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">All posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">If you use &#39;len(s)&#39; to check a string&#39;s length, YOU&#39;RE DOING IT WRONG!!</h1>
			<div class="meta">Posted at &mdash; Jan 3, 2021</div>
		</div>

		<div class="markdown">
			<p>Maybe <code>len(s)</code> doesn&rsquo;t work as you expect. If you use it to determine the length of the string, you must read this post!</p>
<h2 id="one-line-summary">One-line Summary</h2>
<p>Use <code>utf8.RuneCountInString(s)</code> instead when you want to count the number of characters in <code>s</code> because <code>len(s)</code> counts the number of bytes not the number of characters in <code>s</code>.</p>
<h2 id="what-happens-if-i-use-len--s">What happens if I use <code>len(s)</code></h2>
<p>Let&rsquo;s start with using <code>len(s)</code> to determine string&rsquo;s length of <code>A</code>:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#719e07">package</span> main

<span style="color:#719e07">import</span> <span style="color:#2aa198">&#34;fmt&#34;</span>

<span style="color:#268bd2">func</span> <span style="color:#268bd2">main</span>() {
      fmt.<span style="color:#268bd2">Println</span>(<span style="color:#b58900">len</span>(<span style="color:#2aa198">&#34;A&#34;</span>))
}
</code></pre></div><p>Output:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#2aa198">1</span>
</code></pre></div><p>The result is 1! which is what we expects. But what if you use other UTF-8 character, is the behavior of <code>len(s)</code> still be the same?</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#719e07">package</span> main

<span style="color:#719e07">import</span> <span style="color:#2aa198">&#34;fmt&#34;</span>

<span style="color:#268bd2">func</span> <span style="color:#268bd2">main</span>() {
      fmt.<span style="color:#268bd2">Println</span>(<span style="color:#b58900">len</span>(<span style="color:#2aa198">&#34;ก&#34;</span>))
}
</code></pre></div><p>Output:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#2aa198">3</span>
</code></pre></div><p><code>ก</code> is a single UTF-8 thai characters. But somehow, <code>len(&quot;ก&quot;)</code> gives us <code>3</code>! Is <code>len(s)</code> is broken? Let&rsquo;s see&hellip;</p>
<h2 id="what-is-happening">What is happening?</h2>
<p>According to <a href="https://golang.org/pkg/builtin/#len">Go <code>builtin</code> document</a>, <code>func len(v Type) int</code> returns the number of <strong>BYTES</strong> in <code>v</code> if <code>v</code> is <code>String</code>. And because Go&rsquo;s <a href="https://blog.golang.org/strings">source code is UTF-8</a>, <code>len(s)</code> will returns the number of bytes when encoding <code>s</code> using UTF-8. So, let&rsquo;s see the bytes representation of <code>A</code> and <code>ก</code>, is it really UTF-8?:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#719e07">package</span> main

<span style="color:#719e07">import</span> <span style="color:#2aa198">&#34;fmt&#34;</span>

<span style="color:#268bd2">func</span> <span style="color:#268bd2">main</span>() {
      fmt.<span style="color:#268bd2">Printf</span>(<span style="color:#2aa198">&#34;UTF-8 bytes representation of %s: % x\n&#34;</span>, <span style="color:#2aa198">&#34;A&#34;</span>, <span style="color:#2aa198">&#34;A&#34;</span>)
      fmt.<span style="color:#268bd2">Printf</span>(<span style="color:#2aa198">&#34;UTF-8 bytes representation of %s: % x&#34;</span>, <span style="color:#2aa198">&#34;ก&#34;</span>, <span style="color:#2aa198">&#34;ก&#34;</span>)
}
</code></pre></div><p>Output:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">UTF<span style="color:#719e07">-</span><span style="color:#2aa198">8</span> bytes representation of A: <span style="color:#2aa198">41</span>
UTF<span style="color:#719e07">-</span><span style="color:#2aa198">8</span> bytes representation of ก: e0 b8 <span style="color:#2aa198">81</span>
</code></pre></div><p>From the result above, <code>A</code> is composed of one byte, <code>41</code>, and <code>ก</code> is composed of three bytes, <code>e0</code>, <code>b8</code> and <code>81</code> (these numbers are hex-encoded). If you look through the complete list of UTF-8 charset <a href="https://www.fileformat.info/info/charset/UTF-8/list.htm">here</a>, you will see that the bytes representation above match the characters <code>A</code> and <code>ก</code>.
<img src="/ox-hugo/image_1.png" alt="">
<img src="/ox-hugo/image_2.png" alt="">
So, if the string in Go&rsquo;s source code is acutally UTF-8 and <code>len(s)</code> actually return the number of bytes not the number of the character in string, what should we use then?</p>
<h2 id="here-s-come-utf8-package">Here&rsquo;s come utf8 package</h2>
<p>Luckily, Go standard packages contains <code>utf8</code> which used to deal with UTF-8 charset. If you take a look at its document page <a href="https://golang.org/pkg/unicode/utf8/#RuneCountInString">here</a>, you see that there is a function called <code>RuneCountInString(s)</code>. This function iterates the bytes of the given string and count the UTF-8 character. Let&rsquo;s use <code>RuneCountInString(s)</code> on <code>A</code> and <code>ก</code> and see whether it give us the result we expects:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#719e07">package</span> main

<span style="color:#719e07">import</span> (
      <span style="color:#2aa198">&#34;fmt&#34;</span>
      <span style="color:#2aa198">&#34;unicode/utf8&#34;</span>
)

<span style="color:#268bd2">func</span> <span style="color:#268bd2">main</span>() {
      fmt.<span style="color:#268bd2">Printf</span>(<span style="color:#2aa198">&#34;Output from utf8.RuneCountInString(`A`): %d\n&#34;</span>, utf8.<span style="color:#268bd2">RuneCountInString</span>(<span style="color:#2aa198">&#34;A&#34;</span>))
      fmt.<span style="color:#268bd2">Printf</span>(<span style="color:#2aa198">&#34;Output from utf8.RuneCountInString(`ก`): %d&#34;</span>, utf8.<span style="color:#268bd2">RuneCountInString</span>(<span style="color:#2aa198">&#34;ก&#34;</span>))
}
</code></pre></div><p>Output:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">Output from utf8.<span style="color:#268bd2">RuneCountInString</span>(<span style="color:#2aa198">`A`</span>): <span style="color:#2aa198">1</span>
Output from utf8.<span style="color:#268bd2">RuneCountInString</span>(<span style="color:#2aa198">`ก`</span>): <span style="color:#2aa198">1</span>
</code></pre></div><p>The output from <code>utf8.RuneCountInString(s)</code> is what we expect!</p>
<h2 id="summary">Summary</h2>
<p>So, if you&rsquo;re reading til here, please use <code>utf8.RuneCountInString(s)</code> instead <code>len(s)</code> when you want to count the number of characters in <code>s</code> because</p>
<ol>
<li><code>len(s)</code> counts the number of bytes in <code>s</code></li>
<li>Go&rsquo;s treats string as UTF-8 character</li>
<li>Some UTF-8 character can compose of more than one byte!</li>
</ol>

		</div>

		<div class="post-tags">
			
				
			
		</div>
		</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> © Copyright notice |  <a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>




</body>
</html>
